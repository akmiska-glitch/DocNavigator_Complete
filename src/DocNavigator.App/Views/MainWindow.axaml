<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:DocNavigator.App.Controls"
        xmlns:conv="clr-namespace:DocNavigator.App.Converters"
        x:Class="DocNavigator.App.Views.MainWindow"
        Title="DocNavigator" Width="1200" Height="800">

  <Window.Resources>
    <conv:BoolToBrushConverter x:Key="BoolToBrush" />
  </Window.Resources>

  <Grid ColumnDefinitions="300, *" RowDefinitions="Auto, *">

    <StackPanel Grid.ColumnSpan="2" Orientation="Horizontal" Margin="6" Spacing="6">
      <TextBox Width="420" Watermark="Вставьте GUID документа" Text="{Binding GuidInput, Mode=TwoWay}"/>
      <Button Content="Запросить"
              Command="{Binding QueryByGuidCommand}"
              IsEnabled="{Binding CanQuery}"/>

      <ComboBox Width="220"
                ItemsSource="{Binding Profiles}"
                SelectedItem="{Binding SelectedProfile}">
        <ComboBox.ItemTemplate>
          <DataTemplate>
            <TextBlock Text="{Binding Name}"/>
          </DataTemplate>
        </ComboBox.ItemTemplate>
      </ComboBox>

      <Separator Width="12"/>

      <CheckBox Content="Русские названия"
                IsChecked="{Binding UseRussianCaptions, Mode=TwoWay}"/>
      <CheckBox Content="Скрывать пустые"
                Margin="6,0,0,0"
                IsChecked="{Binding HideEmptyColumns, Mode=TwoWay}"/>

      <Separator Width="12"/>

      <Button Content="Вкладка → Excel"
              Command="{Binding ExportActiveTabToExcelCommand}"
              IsEnabled="{Binding HasActiveTab}"/>
      <Button Content="Все таблицы → Excel"
              Command="{Binding ExportAllTabsToExcelCommand}"
              IsEnabled="{Binding CanExportAll}"/>
      <Button Content="Вкладка (RAW CSV)"
              Command="{Binding ExportActiveTabToCsvRawCommand}"
              IsEnabled="{Binding HasActiveTab}"/>
    </StackPanel>

    <ListBox Grid.Row="1"
             ItemsSource="{Binding Tables}"
             SelectedItem="{Binding SelectedTable}">
      <ListBox.ItemTemplate>
        <DataTemplate>
          <StackPanel Orientation="Horizontal" Spacing="8" Margin="6,4">
            <Border Width="10" Height="10" CornerRadius="5"
                    Background="{Binding HasRows, Converter={StaticResource BoolToBrush}}"
                    VerticalAlignment="Center"/>
            <TextBlock Text="{Binding Title}" VerticalAlignment="Center"/>
          </StackPanel>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>

    <TabControl Grid.Column="1" Grid.Row="1"
                ItemsSource="{Binding OpenTabs}"
                SelectedItem="{Binding ActiveTab}">
      <TabControl.ItemTemplate>
        <DataTemplate>
          <StackPanel Orientation="Horizontal" Spacing="6">
            <TextBlock Text="{Binding Header}" VerticalAlignment="Center"/>
            <Button Content="×"
                    Padding="4,0"
                    Command="{Binding DataContext.CloseTabCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                    CommandParameter="{Binding}" />
          </StackPanel>
        </DataTemplate>
      </TabControl.ItemTemplate>
      <TabControl.ContentTemplate>
        <DataTemplate>
          <controls:DataTableGrid Table="{Binding Table}"/>
        </DataTemplate>
      </TabControl.ContentTemplate>
    </TabControl>

  </Grid>
</Window>